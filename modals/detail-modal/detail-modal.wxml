<!-- modals/detail-modal/detail-modal.wxml -->
<view class="modal-container {{visible ? 'visible' : ''}}">
  <view class="modal-backdrop" bindtap="close"></view>
  
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">帖子详情</text>
      <view class="modal-close" bindtap="close">×</view>
    </view>
    
    <view class="modal-body">
      <!-- Loading State -->
      <view wx:if="{{isLoading}}" class="loading-container">
        <view class="loading"></view>
      </view>
      
      <!-- Post Content -->
      <block wx:elif="{{post}}">
        <view class="post-header">
          <image 
            src="{{post.user.avatar }}" 
            class="user-avatar"
          ></image>
          <view class="post-info">
            <view class="username">{{post.user.username}}</view>
            <view class="post-time">{{post.createdAt}}</view>
          </view>
        </view>
        
        <view class="post-content">
          <view class="post-text">{{post.content}}</view>
          
          <!-- Media Files -->
          <view wx:if="{{post.medias && post.medias.length > 0}}" class="media-container">
            <image 
              wx:for="{{post.medias}}" 
              wx:for-item="media" 
              wx:key="id" 
              src="{{ media.url}}" 
              mode="aspectFill" 
              class="media-item {{post.medias.length === 1 ? 'single-media' : ''}}"
              data-url="{{ media.url}}" 
              bindtap="previewImage"
            ></image>
          </view>
          
          <!-- Post Actions -->
          <view class="post-actions">
            <view class="action {{post.liked ? 'liked' : ''}}" bindtap="likePost">
              <view class="like-icon"></view>
              <text>{{post.likes.length}}</text>
            </view>
            <view class="action">
              <view class="comment-icon"></view>
              <text>{{comments.length}}</text>
            </view>
          </view>
        </view>
        
        <!-- Comments Section -->
        <view class="comments-section">
          <view class="section-title">评论 ({{comments.length}})</view>
          
          <!-- Comments List -->
          <view class="comments-list">
            <block wx:if="{{comments.length > 0}}">
              <view wx:for="{{comments}}" wx:key="id" class="comment-item">
                <image 
                  src="{{item.user.avatar }}" 
                  class="comment-avatar"
                ></image>
                <view class="comment-content">
                  <view class="comment-username">{{item.user.username}}</view>
                  <view class="comment-text">{{item.content}}</view>
                  <view class="comment-time">{{item.createdAt}}</view>
                </view>
              </view>
            </block>
            
            <view wx:else class="empty-comments">
              还没有评论，来发表第一条评论吧
            </view>
          </view>
          
          <!-- Comment Form -->
          <view class="comment-form">
            <input 
              class="comment-input" 
              placeholder="写评论..." 
              value="{{newComment}}" 
              bindinput="onInputComment"
            />
            <button 
              class="comment-submit {{commentLoading ? 'loading' : ''}}" 
              disabled="{{commentLoading || !newComment.trim()}}" 
              bindtap="submitComment"
            >
              发送
            </button>
          </view>
        </view>
      </block>
    </view>
  </view>
</view>