<!-- comment-tree-item-child.wxml -->
<view class="comment-tree-item-child">
  <!-- Main Comment -->
  <comment-item 
    wx:if="{{comment}}"
    item="{{comment}}"
    index="{{index}}"
    logged-user="{{loggedUser}}"
    selected-post="{{selectedPost}}"
    bind:like="onLikeHandle"
    bind:edit="onEditHandle"
    bind:reply="onReplyHandle"
    bind:delete="onDeleteHandle"
    bind:imagepreview="onImagePreviewHandle"
    bind:imageupload="onImageUploadHandle"
  />

  <!-- TikTok Style Nested Reply Toggle -->
  <view wx:if="{{hasReplies}}" class="tiktok-nested-toggle">
    <view class="nested-connection-line"></view>
    <view 
      class="tiktok-nested-btn" 
      bindtap="onToggleReplies"
    >
      <text class="nested-toggle-text">
        {{isExpanded ? '收起' : ''}}{{replies.length}}条回复
      </text>
      <image 
        class="nested-toggle-arrow" 
        src="{{isExpanded ? '/images/icons/chevron-up.svg' : '/images/icons/chevron-down.svg'}}" 
      />
    </view>
  </view>

  <!-- Nested Replies Container -->
  <view 
    wx:if="{{hasReplies && isExpanded}}" 
    class="tiktok-nested-replies"
  >
    <!-- Deeper Connection Line -->
    <view class="deep-connection-line"></view>
    
    <!-- Nested Reply Items -->
    <view class="nested-replies-list">
      <comment-tree-item-child 
        wx:for="{{replies}}" 
        wx:key="id"
        comment="{{item}}"
        all-comments="{{allComments}}"
        logged-user="{{loggedUser}}"
        selected-post="{{selectedPost}}"
        depth="{{depth + 1}}"
        bind:like="onLikeHandle"
        bind:edit="onEditHandle"
        bind:reply="onReplyHandle"
        bind:delete="onDeleteHandle"
        bind:imagepreview="onImagePreviewHandle"
        bind:imageupload="onImageUploadHandle"
      />
    </view>
  </view>
</view>
    <view class="reply-toggle-line"></view>
  </view>

  <!-- Nested Replies -->
  <view 
    wx:if="{{hasReplies && isExpanded}}" 
    class="replies-container {{isExpanded ? 'expanded' : 'collapsed'}}"
  >
    <comment-tree-item 
      wx:for="{{replies}}" 
      wx:key="id"
      comment="{{item}}"
      all-comments="{{allComments}}"
      logged-user="{{loggedUser}}"
      selected-post="{{selectedPost}}"
      depth="{{depth + 1}}"
      bind:like="onLikeHandle"
      bind:edit="onEditHandle"
      bind:reply="onReplyHandle"
      bind:delete="onDeleteHandle"
      bind:imagepreview="onImagePreviewHandle"
      bind:imageupload="onImageUploadHandle"
    />
  </view>
</view>