<view class="login-modal">
  <view class="modal-content" catch:tap="preventClose">
    <view class="modal-header">
      <span class="modal-title">ç™»å½•</span>
      <view class="close-btn" bindtap="closeModal">
        <span class="iconfont icon-close">Ã—</span>
      </view>    </view>    <view class="login-tabs">
      <view 
        class="tab-item {{loginType === 'wechat' ? 'active' : ''}}"
        data-type="wechat"
        bindtap="switchLoginType"
      >
        <span>{{messages.loginTypes.wechat}}</span>
      </view>
      <view 
        class="tab-item {{loginType === 'password' ? 'active' : ''}}"
        data-type="password"
        bindtap="switchLoginType"
      >
        <span>{{messages.loginTypes.password}}</span>
      </view>
      <view 
        class="tab-item {{loginType === 'phone' ? 'active' : ''}}"
        data-type="phone"
        bindtap="switchLoginType"
      >
        <span>{{messages.loginTypes.phone}}</span>
      </view>
    
    </view>

    <view class="login-forms">      <view class="form-container {{loginType === 'wechat' ? 'active' : ''}}">
        <view class="wechat-login">
          <view class="wechat-icon">
            <span class="icon">ğŸ”´</span>
          </view>
          <span class="wechat-text">å¾®ä¿¡ä¸€é”®ç™»å½•</span>
          <span class="wechat-desc">å®‰å…¨ä¾¿æ·</span>
          <text class="error-text" wx:if="{{wechatError}}">{{wechatError}}</text>
        </view>      
      </view>

      <!-- Password Login -->
      <view class="form-container {{loginType === 'password' ? 'active' : ''}}">
        <view class="input-group">
          <input
            class="form-input {{loginIdentifierError ? 'error' : ''}}"
            type="text"
            placeholder="{{messages.formLabels.loginIdentifier}}"
            value="{{loginIdentifier}}"
            bindinput="onLoginIdentifierInput"
            disabled="{{loading}}"
          />
          <text class="error-text" wx:if="{{loginIdentifierError}}">{{loginIdentifierError}}</text>
        </view>
        
        <view class="input-group">
          <view class="password-wrapper">
            <input
              class="form-input {{passwordError ? 'error' : ''}}"
              type="text"
              password="{{!showPassword}}"
              placeholder="{{messages.formLabels.password}}"
              value="{{password}}"
              bindinput="onPasswordInput"
              disabled="{{loading}}"
            />
            <view class="password-toggle" bindtap="togglePassword" data-action="toggle">
              <text class="toggle-icon">{{showPassword ? 'ğŸ™ˆ' : 'ğŸ‘'}}</text>
            </view>
          </view>
          <text class="error-text" wx:if="{{passwordError}}">{{passwordError}}</text>
        </view>
      </view>


      <!-- Phone Login -->
      <view class="form-container {{loginType === 'phone' ? 'active' : ''}}">        <view class="input-group">
          <view class="phone-wrapper">
            <view class="country-code">+86</view>
            <input
              class="form-input {{phoneError ? 'error' : ''}}"
              type="number"
              placeholder="{{messages.formLabels.phone}}"
              value="{{phone}}"
              bindinput="onPhoneInput"
              disabled="{{loading}}"
            />
          </view>
          <text class="error-text" wx:if="{{phoneError}}">{{phoneError}}</text>
          <text class="success-text" wx:if="{{phoneSuccessMessage}}">âœ“ {{phoneSuccessMessage}}</text>
        </view>
        
        <view class="input-group">
          <view class="code-wrapper">
            <input
              class="form-input code-input {{codeError ? 'error' : ''}}"
              type="number"
              placeholder="{{messages.formLabels.verificationCode}}"
              value="{{verificationCode}}"
              bindinput="onCodeInput"
              maxlength="6"
              disabled="{{loading}}"
            />
            <button
              class="code-btn {{countdown > 0 ? 'disabled' : ''}}"
              bindtap="sendVerificationCode"
              disabled="{{countdown > 0 || loading}}"
            >
              {{countdown > 0 ? countdown + ' ' + messages.buttons.seconds : messages.buttons.sendCode}}
            </button>
          </view>
          <text class="error-text" wx:if="{{codeError}}">{{codeError}}</text>
        </view>
      </view>
    </view>    <!-- General Error Message -->
    <view class="general-error" wx:if="{{generalError}}">
      <text class="error-text">{{generalError}}</text>
    </view>

    <!-- Login Button -->
    <view class="login-button-wrapper">
      <button
        class="login-btn {{loading ? 'loading' : ''}}"
        bindtap="handleLogin"
        disabled="{{loading}}"
      >
        <span wx:if="{{!loading}}">
          {{loginType === 'wechat' ? 'å¾®ä¿¡ç™»å½•' : messages.buttons.login}}
        </span>
        <span wx:if="{{loading}}">ç™»å½•ä¸­...</span>
      </button>
    </view>

    <!-- Register Link -->
    <view class="register-link-wrapper">
      <view class="register-link" bindtap="goToRegister">
        <text class="register-text">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ</text>
        <text class="register-btn-text">{{messages.buttons.register}}</text>
      </view>
      <view class="forgot-password-link" bindtap="goToForgotPassword">
        <text class="forgot-password-text">å¿˜è®°å¯†ç ï¼Ÿ</text>
      </view>
    </view>

    <!-- Terms Agreement Checkbox -->
    <view class="terms-agreement">
      <checkbox-group bindchange="onAgreeChange">
        <label class="agreement-label">
          <checkbox value="agree" checked="{{termsAgreed}}" color="#007AFF" />
        </label>
      </checkbox-group>
      <view class="agreement-text">
        <text class="agreement-prefix">ç™»å½•æˆ–æ³¨å†Œå³ä»£è¡¨åŒæ„</text>
        <text class="agreement-link" bindtap="goToTerms">ã€Šç”¨æˆ·åè®®ã€‹</text>
        <text class="agreement-and">å’Œ</text>
        <text class="agreement-link" bindtap="goToPrivacy">ã€Šéšç§æ”¿ç­–ã€‹</text>
      </view>
    </view>

    <!-- Loading Overlay -->
    <view class="loading-container" wx:if="{{loading}}">
      <image class="loading-logo small" src="/images/logo.png" mode="aspectFit"></image>
      <view class="loading-progress-bar small">
        <view class="loading-progress-fill"></view>
      </view>
      <text class="loading-text">{{loadingMessage || 'å¤„ç†ä¸­...'}}</text>
    </view>
  </view>
</view>
