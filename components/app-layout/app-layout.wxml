<!-- app-layout.wxml -->
<view class="app-layout {{isTeacher ? 'teacher-layout' : ''}} {{currentPage === 'index' ? 'discover-page' : ''}}" data-layout-type="{{isTeacher ? 'teacher' : 'user'}}">  
  <!-- Top Filter Bar -->
  <view class="app-layout-header {{showSearch ? 'header-hidden' : ''}}">
    <scroll-view class="filter-scroll" scroll-x="true" scroll-left="{{filterScrollLeft}}">
      <view class="filter-tabs {{dynamicTabStyle === 'compact' ? 'compact-mode' : 'expanded-mode'}}">        
        <view 
          wx:for="{{pages}}" 
          wx:key="key"
          wx:if="{{item.type === 'filter'}}"
          class="filter-tab {{currentPage === item.key ? 'active' : ''}}"
          data-page="{{item.key}}"
          bindtap="onPageTap"
        >
          <text class="filter-text">{{item.name}}</text>
        </view>
        <!-- Company Button as Filter Tab -->
        <view class="filter-tab company-tab" bindtap="onCompanyButtonTap">
          <text class="filter-text">企业</text>
        </view>
      </view>
    </scroll-view>
    <!-- Search Icon -->
    <view class="search-icon-button" bindtap="onSearchIconTap">
      <image src="/images/icons/search.svg" mode="aspectFit" class="search-icon" />
    </view>
  </view>

  <!-- Animated Search Bar -->
  <view class="search-bar-wrapper {{showSearch ? 'search-visible' : ''}}">
    <view class="search-bar-header">
      <!-- Back Button -->
      <view class="search-back-button" bindtap="onSearchBackTap">
        <image src="/images/icons/chevron-left.svg" mode="aspectFit" class="back-icon" />
      </view>
      <!-- Search Bar Content -->
      <search-bar 
        wx:if="{{showSearch}}"
        current-page="{{currentPage}}" 
        search-params="{{effectiveSearchParams}}"
        bind:search="onSearch"
        auto-focus="{{showSearch}}"
      ></search-bar>
    </view>
  </view>

  <!-- Main Content Area -->
  <view class="app-layout-content">
    <slot></slot>
  </view>
  <view class="app-layout-footer" wx:if="{{!isTeacher}}">
    <view class="tab-container">      
      <view 
        wx:for="{{pages}}" 
        wx:key="key"
        wx:if="{{item.type === 'tab'}}"
        class="tab-item {{currentPage === item.key ? 'active' : ''}} {{item.isSpecial ? 'special' : ''}}"
        data-page="{{item.key}}"
        bindtap="onPageTap"
      >
        <view class="tab-icon-container">
          <view class="tab-icon">            
            <image 
              src="{{currentPage === item.key ? item.activeIcon : item.icon}}" 
              mode="aspectFit"
              class="tab-icon-image"
            />
          </view>
          <!-- Unread Badge -->
          <view 
            wx:if="{{item.key === 'chat' && totalUnreadCount > 0}}"
            class="unread-badge"
          >
            <text class="unread-count">{{totalUnreadCount > 99 ? '99+' : totalUnreadCount}}</text>
          </view>
          <view 
            wx:if="{{item.key === 'notification' && notificationCount > 0}}"
            class="unread-badge"
          >
            <text class="unread-count">{{notificationCount > 99 ? '99+' : notificationCount}}</text>
          </view>
        </view>        
        <text class="tab-text">{{item.name}}</text>
      </view>
    </view>
  </view>
  
  <!-- Login Modal -->
  <login-modal 
    wx:if="{{showLoginModal}}"
    bind:close="onLoginModalClose"
    bind:success="onLoginSuccess"
  >
  </login-modal>
</view>