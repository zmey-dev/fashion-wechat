<!-- pages/post-detail/post-detail.wxml -->
<app-layout current-page="">
  <!-- Login Modal -->
  <login-modal wx:if="{{ showLoginModal }}" class="login-modal" />
  
  <!-- Post Viewer Container -->
  <view class="post-viewer-container {{userInfo.role === 'teacher' ? 'teacher-layout' : ''}}">
    <!-- Loading State - Show when loading (highest priority) -->
    <view wx:if="{{ isLoading }}" class="loading-container">
      <image class="loading-logo" src="/images/logo.png" mode="aspectFit"></image>
      <view class="loading-progress-bar">
        <view class="loading-progress-fill"></view>
      </view>
      <text class="loading-text">{{messages.loading}}</text>
    </view>
    
    <!-- Media Player Component - Show when post exists and not loading -->
    <media-player
      id="media-player"
      wx:elif="{{ post && !isLoading }}"
      selectedPost="{{ post }}"
      selectedPostUser="{{ post.user }}"
      followedUsers="{{ followedUsers }}"
      authUser="{{ userInfo }}"
      index="{{ 0 }}"
      totalCount="{{ 1 }}"
      event-id="{{ eventId }}"
      is-loading="{{ false }}"
      bind:postNavigation="handlePostNavigation"
      bind:likeUpdated="handleLikeUpdated"
      bind:favoriteUpdated="handleFavoriteUpdated"
      bind:shareUpdated="handleShareUpdated"
      bind:followUpdated="handleFollowUpdated"
      bind:showLogin="showLoginModal"
      bind:navigateToProfile="navigateToUserProfile"
      bind:previousPost="handlePreviousPost"
      bind:nextPost="handleNextPost"
    >
    </media-player>

    
    
    <!-- Error State - Show when there's an error after attempting to load -->
    <view wx:elif="{{ hasError && hasLoadedOnce }}" class="error-container">
      <view class="error-icon">⚠️</view>
      <text class="error-text">{{errorMessage}}</text>
      <button class="retry-btn" bindtap="onRetry">重试</button>
    </view>
    
    <!-- Empty State - Only show when truly no content and not during any transitions -->
    <view wx:elif="{{ !post && !isLoading && !hasError && hasLoadedOnce && !isNavigating && !isTransitioning }}" class="empty-container">
      <view class="empty-icon">📭</view>
      <text class="empty-text">内容不存在</text>
      <button class="back-btn" bindtap="onRetry">返回</button>
    </view>

  </view>
</app-layout>
