<!--pages/follow/follow.wxml-->
<view class="container">
  <slide-sidebar 
    current-path="{{ currentPath }}" 
    is-visible="{{ showSidebar }}" 
    userInfo="{{ userInfo }}"
    bind:hideSidebar="closeSideBar"
    style="position:relative; width: 100%; background: black; height: 100rpx"
    >
    <view style="position:relative; width: 100%; background: #d3d3d3; height: 100px"></view>
    <textarea placeholder="è¯·è¾“å…¥" placeholder-style="color:blue;" />
  </slide-sidebar>
  <!-- User List View -->
  <view class="user-list" wx:if="{{!showUserMedia}}">
    <view class="page-header">
      <text class="page-title">å…³æ³¨</text>
    </view>
    
    <!-- Search Bar -->
    <view class="search-container">
      <view class="search-box">
        <view class="search-icon">ğŸ”</view>
        <input 
          class="search-input" 
          type="text" 
          placeholder="æœç´¢ç”¨æˆ·" 
          value="{{searchValue}}"
          bindinput="searchUsers"
          confirm-type="search"
        />
        <view class="clear-icon" bindtap="clearSearch" wx:if="{{searchValue}}">âœ•</view>
      </view>
    </view>
    
    <view class="no-results" wx:if="{{filteredUserList.length === 0}}">
      <text>æœªæ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ·</text>
    </view>
    
    <view class="user-item" wx:for="{{filteredUserList}}" wx:key="id" bindtap="selectUser" data-id="{{item.id}}">
      <avatar class="user-avatar" avatar="{{item.avatar}}" name="{{item.username}}" size="{{70}}" mode="aspectFill"></avatar>
      <view class="user-info">
        <text class="user-nickname">{{item.username}}</text>
        <text class="user-followers">ç²‰ä¸ {{item.followers}}äºº</text>
      </view>
      <view class="user-arrow">
        <text class="arrow-icon">></text>
      </view>
    </view>
  </view>

  <!-- User Media View -->
  <view class="user-media-container" wx:if="{{showUserMedia}}">
    <view class="media-header">
      <view class="back-button" bindtap="backToUserList">
        <text class="back-icon">â†</text>
      </view>
      <view class="user-profile">
      <avatar class="user-avatar" avatar="{{currentUser.avatar}}" name="{{currentUser.username}}" size="{{70}}" mode="aspectFill"></avatar>
        <text class="profile-nickname">{{currentUser.username}}</text>
      </view>
    </view>
    <view class="media-stats">
      <!-- Follow/Unfollow Button -->
      <button 
        class="action-button {{currentUser.isFollowed ? 'bg-green-800' : 'bg-dark'}}" 
        bindtap="handleFollowToggle">
        <block wx:if="{{currentUser.isFollowed}}">
          <view class="button-content">
            <text class="icon">-</text>
            <text class="label">å–æ¶ˆå…³æ³¨</text>
          </view>
        </block>
        <block wx:else>
          <view class="button-content">
            <text class="icon">âœ“</text>
            <text class="label">å…³ æ³¨</text>
          </view>
        </block>
      </button>

      <!-- Friend Button -->
      <button 
        class="action-button {{currentUser.isFriend ? (currentUser.isAllow ? 'bg-green-800' : 'bg-yellow-800') : 'bg-dark'}}" 
        bindtap="handleFriendToggle">
        <block wx:if="{{currentUser.isFriend}}">
          <view class="button-content">
            <text class="icon">-</text>
            <text class="label">å–æ¶ˆå¥½å‹</text>
          </view>
        </block>
        <block wx:else>
          <view class="button-content">
            <text class="icon">+</text>
            <text class="label">ç”³è¯·å¥½å‹</text>
          </view>
        </block>
      </button>

      <!-- Message Button (only shown if they are friends) -->
      <button 
        class="action-button bg-dark" 
        bindtap="handleSendMessage"
        wx:if="{{currentUser.isFriend}}">
        <view class="button-content">
          <text class="icon">ğŸ’¬</text>
          <text class="label">ç•™è¨€</text>
        </view>
      </button>
    </view>

    <view class="media-grid">
      <view class="media-item" wx:for="{{userMediaList}}" wx:key="id" bindtap="previewImage" data-id="{{item.id}}">
        <image wx:if="{{item.type=='image'}}" class="media-image" src="{{item.media[0].url}}" mode="aspectFill"></image>
        <image wx:else class="media-image" src="{{item.media[0].preview_url}}" mode="aspectFill"></image>
        <view class="media-info">
          <view class="media-stats">
            <text class="media-likes">â™¥ {{item.likes}}</text>
            <text class="media-comments">ğŸ’¬ {{item.comments}}</text>
          </view>
          <text class="media-description">{{item.description}}</text>
        </view>
      </view>
    </view>

    <view class="loading-indicator" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>
    <view class="no-more" wx:if="{{!hasMore && userMediaList.length > 0}}">
      <text>æ²¡æœ‰æ›´å¤šå†…å®¹</text>
    </view>
  </view>
</view>