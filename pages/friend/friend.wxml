<!--pages/friend/friend.wxml-->
<view class="page-container">
  <!-- Filter bar component -->
  <filter-bar currentFilter="friend"></filter-bar>

  <!-- Main content container -->
  <view class="content-container">
    <!-- User List View -->
    <view class="user-list" wx:if="{{!showUserMedia}}">
      <view class="page-header">
        <text class="page-title">好友</text>
      </view>
      
      <!-- Search Bar -->
      <view class="search-container">
        <view class="search-box">
          <view class="search-icon">🔍</view>
          <input 
            class="search-input" 
            type="text" 
            placeholder="搜索好友" 
            value="{{searchValue}}"
            bindinput="searchUsers"
            confirm-type="search"
          />
          <view class="clear-icon" bindtap="clearSearch" wx:if="{{searchValue}}">✕</view>
        </view>
      </view>
      
      <!-- No results message -->
      <view class="no-results" wx:if="{{filteredUserList.length === 0}}">
        <text>未找到匹配的用户</text>
      </view>
      
      <!-- User list items -->
      <view class="user-item" wx:for="{{filteredUserList}}" wx:key="id" bindtap="selectUser" data-id="{{item.id}}">
        <avatar class="user-avatar" avatar="{{item.avatar}}" name="{{item.username}}" size="{{70}}"></avatar>
        <view class="user-info">
          <text class="user-nickname">{{item.username}}</text>
          <text class="user-followers">粉丝 {{item.followers}}人</text>
        </view>
        <view class="user-arrow">
          <text class="arrow-icon">></text>
        </view>
      </view>
    </view>

    <!-- User Media View -->
    <view class="user-media-container" wx:if="{{showUserMedia}}">
      <!-- Media header with back button and user profile -->
      <view class="media-header">
        <view class="back-button" bindtap="backToUserList">
          <text class="back-icon">←</text>
        </view>
        <view class="user-profile">
          <avatar class="user-avatar" avatar="{{currentUser.avatar}}" name="{{currentUser.username}}" size="{{70}}"></avatar>
          <text class="profile-nickname">{{currentUser.username}}</text>
        </view>
      </view>
      
      <!-- Action buttons for follow, friend, and message -->
      <view class="media-stats">
        <!-- Follow/Unfollow Button -->
        <button 
          class="action-button {{currentUser.isFollowed ? 'bg-green-800' : 'bg-dark'}}" 
          bindtap="handleFollowToggle">
          <block wx:if="{{currentUser.isFollowed}}">
            <view class="button-content">
              <text class="icon">-</text>
              <text class="label">取消关注</text>
            </view>
          </block>
          <block wx:else>
            <view class="button-content">
              <text class="icon">✓</text>
              <text class="label">关 注</text>
            </view>
          </block>
        </button>

        <!-- Friend Button -->
        <button 
          class="action-button {{currentUser.isFriend ? 'bg-green-800' : 'bg-dark'}}" 
          bindtap="handleFriendToggle">
          <block wx:if="{{currentUser.isFriend}}">
            <view class="button-content">
              <text class="icon">-</text>
              <text class="label">取消好友</text>
            </view>
          </block>
          <block wx:else>
            <view class="button-content">
              <text class="icon">+</text>
              <text class="label">添加好友</text>
            </view>
          </block>
        </button>

        <!-- Message Button -->
        <button 
          class="action-button bg-dark" 
          bindtap="handleSendMessage"
          wx:if="{{currentUser.isFriend}}">
          <view class="button-content">
            <text class="icon">💬</text>
            <text class="label">发消息</text>
          </view>
        </button>
      </view>

      <!-- Media grid displaying user's posts -->
      <view class="media-grid">
        <view class="media-item" wx:for="{{userMediaList}}" wx:key="id" bindtap="previewImage" data-id="{{item.id}}">
          <image wx:if="{{item.type=='image'}}" class="media-image" src="{{item.media[0].url}}" mode="aspectFill"></image>
          <image wx:else class="media-image" src="{{item.media[0].preview_url}}" mode="aspectFill"></image>
          <view class="media-info">
            <view class="media-stats">
              <text class="media-likes">♥ {{item.likes}}</text>
              <text class="media-comments">💬 {{item.comments}}</text>
            </view>
            <text class="media-description">{{item.description}}</text>
          </view>
        </view>
      </view>

      <!-- Loading indicator -->
      <view class="loading-indicator" wx:if="{{loading}}">
        <text>{{messages.loading}}</text>
      </view>
      
      <!-- No more content message -->
      <view class="no-more" wx:if="{{!hasMore && userMediaList.length > 0}}">
        <text>没有更多内容</text>
      </view>
    </view>
  </view>

  <!-- Bottom tab bar component -->
  <douyin-tabbar current="friend"></douyin-tabbar>
</view>