<!--pages/event-create/event-create.wxml-->
<app-layout currentPage="event-create" hideTabBar="{{true}}">
  <!-- Modal overlay background -->
  <view class="modal-overlay">
    <!-- Modal container -->
    <view class="modal-container">
      <!-- Close button -->
      <view class="close-btn" bindtap="onCancel">
        <text class="close-icon">✕</text>
      </view>

      <!-- Form content -->
      <scroll-view class="form-scroll" scroll-y="{{true}}">
        <view class="form-content">
          <!-- Event Title Section -->
          <view class="title-section">
            <text class="section-label">活动名称:</text>
            <input 
              class="title-input {{errors.title ? 'error' : ''}}"
              placeholder="输入活动标题"
              value="{{form.title}}"
              bindinput="onTitleInput"
              maxlength="100"
            />
            <text class="error-text" wx:if="{{errors.title}}">{{errors.title}}</text>
          </view>

          <!-- Poster Image Section -->
          <view class="poster-section">
            <view class="poster-container" bindtap="chooseImage">
              <image 
                wx:if="{{posterImageUrl}}"
                class="poster-image"
                src="{{posterImageUrl}}"
                mode="aspectFit"
              />
              <view wx:else class="poster-placeholder">
                <text class="placeholder-text">未上传海报图...</text>
              </view>
            </view>
          </view>

          <!-- Event Details Grid -->
          <view class="details-grid">
            <!-- Event Time -->
            <view class="grid-row">
              <view class="grid-label">活动时间</view>
              <view class="grid-content">
                <view class="time-buttons">
                  <view class="time-btn" bindtap="showStartCalendar">
                    <text>开始时间：{{startDateDisplay}}</text>
                  </view>
                  <view class="time-btn" bindtap="showEndCalendar">
                    <text>结束时间：{{endDateDisplay}}</text>
                  </view>
                </view>
              </view>
            </view>

            <!-- Event Location -->
            <view class="grid-row">
              <view class="grid-label">活动地点</view>
              <view class="grid-content">
                <input 
                  class="form-input {{errors.location ? 'error' : ''}}"
                  placeholder="输入活动地点"
                  value="{{form.location}}"
                  bindinput="onLocationInput"
                  maxlength="200"
                />
                <text class="error-text" wx:if="{{errors.location}}">{{errors.location}}</text>
              </view>
            </view>

            <!-- Registration Deadline -->
            <view class="grid-row">
              <view class="grid-label">报名截止</view>
              <view class="grid-content">
                <view class="time-btn" bindtap="showDeadlineCalendar">
                  <text>{{deadlineDateDisplay}}</text>
                </view>
              </view>
            </view>

            <!-- Student Participation -->
            <view class="grid-row">
              <view class="grid-label">参赛学生是否只限制我校学生</view>
              <view class="grid-content">
                <view class="radio-group">
                  <view 
                    class="radio-option {{!form.allow_other_school ? 'active' : ''}}" 
                    bindtap="selectSchoolOption" 
                    data-value="own"
                  >
                    <view class="radio-circle {{!form.allow_other_school ? 'checked' : ''}}"></view>
                    <text class="radio-text">是</text>
                  </view>
                  <view 
                    class="radio-option {{form.allow_other_school ? 'active' : ''}}" 
                    bindtap="selectSchoolOption" 
                    data-value="all"
                  >
                    <view class="radio-circle {{form.allow_other_school ? 'checked' : ''}}"></view>
                    <text class="radio-text">否</text>
                  </view>
                </view>
              </view>
            </view>

            <!-- Participant Limit -->
            <view class="grid-row">
              <view class="grid-label">参赛人数上限</view>
              <view class="grid-content">
                <view class="checkbox-container">
                  <view class="checkbox {{form.allow_limit ? 'checked' : ''}}" bindtap="toggleLimitCheckbox"></view>
                  <text class="checkbox-label">设置上限</text>
                  <input 
                    wx:if="{{form.allow_limit}}"
                    class="number-input {{errors.limit ? 'error' : ''}}"
                    placeholder="人数"
                    value="{{form.limit}}"
                    bindinput="onLimitInput"
                    type="number"
                  />
                </view>
                <text class="error-text" wx:if="{{errors.limit}}">{{errors.limit}}</text>
              </view>
            </view>

            <!-- Contact Information -->
            <view class="grid-row">
              <view class="grid-label">联系方式</view>
              <view class="grid-content">
                <input 
                  class="form-input {{errors.contact_info ? 'error' : ''}}"
                  placeholder="输入联系方式"
                  value="{{form.contact_info}}"
                  bindinput="onContactInput"
                  maxlength="200"
                />
                <text class="error-text" wx:if="{{errors.contact_info}}">{{errors.contact_info}}</text>
              </view>
            </view>

            <!-- Rich Text Editor Section -->
            <view class="grid-row">
              <view class="grid-label">活动说明和规则</view>
              <view class="grid-content">
                <view class="editor-section">
                  <!-- Editor Toolbar -->
                  <view class="editor-toolbar">
                    <view class="editor-btn {{formats.bold ? 'active' : ''}}" bindtap="onEditorFormat" data-name="bold" data-value="{{!formats.bold}}">
                      <text>B</text>
                    </view>
                    <view class="editor-btn {{formats.italic ? 'active' : ''}}" bindtap="onEditorFormat" data-name="italic" data-value="{{!formats.italic}}">
                      <text>I</text>
                    </view>
                    <view class="editor-btn {{formats.underline ? 'active' : ''}}" bindtap="onEditorFormat" data-name="underline" data-value="{{!formats.underline}}">
                      <text>U</text>
                    </view>
                    <view class="editor-btn" bindtap="onEditorFormat" data-name="align" data-value="left">
                      <text>左</text>
                    </view>
                    <view class="editor-btn" bindtap="onEditorFormat" data-name="align" data-value="center">
                      <text>中</text>
                    </view>
                    <view class="editor-btn" bindtap="onEditorFormat" data-name="align" data-value="right">
                      <text>右</text>
                    </view>
                  </view>
                  
                  <!-- Editor Container -->
                  <view class="editor-container">
                    <editor 
                      id="editor"
                      class="editor"
                      placeholder="请详细说明活动规则和注意事项..."
                      bindinput="onEditorInput"
                      bindready="onEditorReady"
                      show-img-size
                      show-img-toolbar
                      show-img-resize
                    ></editor>
                  </view>
                </view>
                <text class="error-text" wx:if="{{errors.description}}">{{errors.description}}</text>
              </view>
            </view>
          </view>

          <!-- Action Buttons -->
          <view class="action-buttons">
            <button class="btn-cancel" bindtap="onCancel">取消</button>
            <button class="btn-save {{loading ? 'loading' : ''}}" bindtap="onSave" disabled="{{loading}}">
              <text>{{loading ? '保存中...' : (isEditMode ? '更新活动' : '创建活动')}}</text>
            </button>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- Calendar Modal -->
    <view class="calendar-modal" wx:if="{{showStartCalendar || showEndCalendar || showDeadlineCalendar}}">
      <view class="calendar-container">
        <view class="calendar-header">
          <text class="calendar-title">选择日期</text>
        </view>
        
        <view class="calendar-nav">
          <view class="nav-btn" bindtap="prevMonth">
            <text>&lt;</text>
          </view>
          <view class="current-month">
            <text>{{currentYear}}年{{currentMonth}}月</text>
          </view>
          <view class="nav-btn" bindtap="nextMonth">
            <text>&gt;</text>
          </view>
        </view>
        
        <view class="calendar-grid">
          <!-- Weekday headers -->
          <view class="weekday">日</view>
          <view class="weekday">一</view>
          <view class="weekday">二</view>
          <view class="weekday">三</view>
          <view class="weekday">四</view>
          <view class="weekday">五</view>
          <view class="weekday">六</view>
          
          <!-- Calendar dates -->
          <view 
            wx:for="{{calendarDates}}" 
            wx:key="index"
            class="date-cell {{item.isToday ? 'today' : ''}} {{item.isSelected ? 'selected' : ''}} {{item.isOtherMonth ? 'other-month' : ''}}"
            bindtap="selectCalendarDate"
            data-date="{{item.fullDate}}"
          >
            <text>{{item.day}}</text>
          </view>
        </view>
        
        <view class="calendar-actions">
          <view class="calendar-btn calendar-btn-cancel" bindtap="closeCalendar">
            <text>取消</text>
          </view>
          <view class="calendar-btn calendar-btn-confirm" bindtap="confirmCalendarDate">
            <text>确定</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</app-layout>
