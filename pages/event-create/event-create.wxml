<!-- create-event.wxml -->
<view class="page-container">
  <!-- Main Content -->
  <scroll-view scroll-y="{{true}}" class="content-scroll">
    <view class="content-wrapper">
      
      <!-- Poster Upload Section -->
      <view class="poster-section">
        <view class="poster-container" bindtap="triggerFileInput">
          <view wx:if="{{posterImageUrl}}" class="poster-preview">
            <image 
              src="{{posterImageUrl}}" 
              class="poster-image"
              mode="aspectFill"
            />
            <view class="poster-overlay">
              <text class="camera-icon">ğŸ“·</text>
              <text class="upload-text">ç‚¹å‡»æ›´æ¢æµ·æŠ¥</text>
            </view>
          </view>
          <view wx:else class="poster-placeholder">
            <text class="camera-icon">ğŸ“·</text>
            <text class="upload-text">ç‚¹å‡»ä¸Šä¼ æ´»åŠ¨æµ·æŠ¥</text>
            <text class="upload-hint">å»ºè®®å°ºå¯¸ 750x400</text>
          </view>
        </view>
        
        <!-- Upload status indicator -->
        <view wx:if="{{posterUploading || posterUploaded || posterUploadError}}" class="upload-status">
          <view wx:if="{{posterUploading}}" class="upload-progress">
            <text class="upload-progress-text">ä¸Šä¼ ä¸­... {{posterUploadProgress}}%</text>
            <progress percent="{{posterUploadProgress}}" stroke-width="4" active show-info/>
          </view>
          <view wx:elif="{{posterUploaded}}" class="upload-success">
            <text class="success-icon">âœ“</text>
            <text class="success-text">ä¸Šä¼ æˆåŠŸ</text>
          </view>
          <view wx:elif="{{posterUploadError}}" class="upload-error">
            <text class="error-icon">âœ—</text>
            <text class="error-text">ä¸Šä¼ å¤±è´¥ï¼š{{posterUploadError}}</text>
          </view>
        </view>
      </view>

      <!-- Form Content -->
      <view class="form-content">
        
        <!-- Event Title -->
        <view class="form-group">
          <view class="form-label">
            <text class="label-text">æ´»åŠ¨æ ‡é¢˜</text>
            <text class="required">*</text>
          </view>
          <view class="input-wrapper">
            <input 
              class="form-input"
              value="{{title}}"
              bindinput="onTitleInput"
              placeholder="è¯·è¾“å…¥æ´»åŠ¨æ ‡é¢˜"
              maxlength="50"
            />
            <view class="char-count">{{title.length}}/50</view>
          </view>
        </view>        <!-- Event Time -->
        <view class="form-group">
          <view class="form-label">
            <text class="label-text">æ´»åŠ¨æ—¶é—´</text>
            <text class="required">*</text>
          </view>
          <view class="time-selector">
            <view class="time-item" bindtap="showStartCalendar">
              <view class="time-label">å¼€å§‹æ—¶é—´</view>
              <view class="time-value">
                <text class="{{startDateDisplay === 'é€‰æ‹©å¼€å§‹æ—¶é—´' ? 'placeholder' : ''}}">
                  {{startDateDisplay}}
                </text>
                <text class="arrow-icon">â€º</text>
              </view>
            </view>
            <view class="time-divider"></view>
            <view class="time-item" bindtap="showEndCalendar">
              <view class="time-label">ç»“æŸæ—¶é—´</view>
              <view class="time-value">
                <text class="{{endDateDisplay === 'é€‰æ‹©ç»“æŸæ—¶é—´' ? 'placeholder' : ''}}">
                  {{endDateDisplay}}
                </text>
                <text class="arrow-icon">â€º</text>
              </view>
            </view>
          </view>
        </view>

        <!-- University -->
        <view class="form-group">
          <view class="form-label">
            <text class="label-text">ä¸»åŠæ–¹</text>
          </view>
          <view class="readonly-field">
            <text class="readonly-text">{{universityName}}</text>
          </view>
        </view>

        <!-- Registration Settings -->
        <view class="form-group">
          <view class="form-label">
            <text class="label-text">æŠ¥åè®¾ç½®</text>
          </view>
          
          <!-- School Restriction -->
          <view class="setting-item">
            <view class="setting-info">
              <text class="setting-title">å…è®¸å…¶ä»–å­¦æ ¡å­¦ç”Ÿå‚åŠ </text>
              <text class="setting-desc">å¼€å¯åï¼Œå…¶ä»–å­¦æ ¡å­¦ç”Ÿä¹Ÿå¯ä»¥æŠ¥åå‚åŠ </text>
            </view>
            <switch 
              checked="{{allowOtherSchool}}"
              bindchange="onSchoolSwitchChange"
              color="#007aff"
            />
          </view>

          <!-- Participant Limit -->
          <view class="setting-item">
            <view class="setting-info">
              <text class="setting-title">é™åˆ¶å‚ä¸äººæ•°</text>
              <text class="setting-desc">è®¾ç½®æ´»åŠ¨æœ€å¤§å‚ä¸äººæ•°</text>
            </view>
            <switch 
              checked="{{allowLimit}}"
              bindchange="onLimitSwitchChange"
              color="#007aff"
            />
          </view>          <!-- Limit Input -->
          <view wx:if="{{allowLimit}}" class="limit-input-section">
            <view class="input-wrapper">
              <input 
                class="form-input number-input"
                type="number"
                value="{{limit}}"
                bindinput="onLimitInput"
                placeholder="è¯·è¾“å…¥äººæ•°ä¸Šé™"
              />
              <text class="input-unit">äºº</text>
            </view>
          </view>
        </view>

        <!-- Event Description -->
        <view class="form-group">
          <view class="form-label">
            <text class="label-text">æ´»åŠ¨è¯´æ˜</text>
            <text class="required">*</text>
          </view>
          <view class="editor-section">
            <!-- Editor Toolbar -->
            <view class="editor-toolbar">
              <view class="toolbar-group">
                <view 
                  class="toolbar-btn {{formats.bold ? 'active' : ''}}"
                  bindtap="onEditorFormat"
                  data-name="bold"
                >
                  <text class="btn-icon">B</text>
                </view>
                <view 
                  class="toolbar-btn {{formats.italic ? 'active' : ''}}"
                  bindtap="onEditorFormat"
                  data-name="italic"
                >
                  <text class="btn-icon italic">I</text>
                </view>
                <view 
                  class="toolbar-btn {{formats.underline ? 'active' : ''}}"
                  bindtap="onEditorFormat"
                  data-name="underline"
                >
                  <text class="btn-icon underline">U</text>
                </view>
              </view>
              <view class="toolbar-group">
                <view 
                  class="toolbar-btn"
                  bindtap="onEditorFormat"
                  data-name="align"
                  data-value="left"
                >
                  <text class="btn-icon">â‰¡</text>
                </view>
                <view 
                  class="toolbar-btn"
                  bindtap="onEditorFormat"
                  data-name="align"
                  data-value="center"
                >
                  <text class="btn-icon">â‰£</text>
                </view>
              </view>
            </view>
            
            <!-- Rich Text Editor -->
            <editor 
              id="editor"
              class="rich-editor"
              placeholder="è¯·è¯¦ç»†æè¿°æ´»åŠ¨å†…å®¹ã€è§„åˆ™ã€å¥–å“ç­‰ä¿¡æ¯..."
              bindinput="onEditorInput"
              bindready="onEditorReady"
              show-img-size="{{false}}"
              show-img-toolbar="{{false}}"
            />
          </view>
        </view>

      </view>
    </view>
  </scroll-view>

  <!-- Bottom Action -->
  <view class="bottom-action">
    <button 
      class="submit-btn {{isUploading ? 'loading' : ''}}"
      bindtap="handleSubmit"
      disabled="{{isUploading}}"
    >
      <view wx:if="{{isUploading}}" class="loading-content">
        <view class="loading-spinner"></view>
        <text>å‘å¸ƒä¸­...</text>
      </view>
      <text wx:else>{{eventId ? 'ä¿å­˜ä¿®æ”¹' : 'å‘å¸ƒæ´»åŠ¨'}}</text>
    </button>
  </view>

  <!-- Hidden Canvas for Image Compression -->
  <canvas 
    canvas-id="compressCanvas" 
    style="position: fixed; top: -9999px; left: -9999px; width: 1920px; height: 1920px;"
  ></canvas>

  <!-- Calendar Modal -->
  <view class="calendar-modal" wx:if="{{showStartCalendar || showEndCalendar}}">
    <view class="calendar-mask" bindtap="closeCalendar"></view>
    <view class="calendar-container">
      <view class="calendar-header">
        <view class="calendar-title">
          é€‰æ‹©{{showStartCalendar ? 'å¼€å§‹' : 'ç»“æŸ'}}æ—¶é—´
        </view>
        <view class="calendar-close" bindtap="closeCalendar">
          <text>Ã—</text>
        </view>
      </view>
      
      <view class="calendar-content">
        <view class="calendar-nav">
          <view class="nav-btn" bindtap="prevMonth">
            <text class="nav-arrow">â€¹</text>
          </view>
          <view class="month-display">
            {{calendarData.currentYear}}å¹´{{calendarData.currentMonth}}æœˆ
          </view>
          <view class="nav-btn" bindtap="nextMonth">
            <text class="nav-arrow">â€º</text>
          </view>
        </view>
        
        <view class="calendar-grid">
          <view class="weekday" wx:for="{{['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']}}" wx:key="*this">
            {{item}}
          </view>
          
          <view 
            wx:for="{{calendarData.calendarDates}}" 
            wx:key="index"
            class="calendar-date {{item.isToday ? 'today' : ''}} {{item.isSelected ? 'selected' : ''}} {{item.isOtherMonth ? 'other-month' : ''}}"
            bindtap="selectCalendarDate"
            data-date="{{item.fullDate}}"
          >
            {{item.day}}
          </view>
        </view>

        <view class="calendar-actions">
          <button class="calendar-btn cancel" bindtap="closeCalendar">å–æ¶ˆ</button>
          <button class="calendar-btn confirm" bindtap="confirmCalendarDate">ç¡®å®š</button>
        </view>
      </view>
    </view>
  </view>
</view>