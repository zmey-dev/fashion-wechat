<view class="page-container">
  <filter-bar currentFilter="discover"></filter-bar>

  <!-- Main Content Area -->
  <view class="content-area" id="contentArea">
    <!-- Posts Grid -->
    <view class="posts-grid">
      <view 
        wx:for="{{posts}}" 
        wx:key="id"
        class="post-card"
        data-post-id="{{item.id}}"
        data-index="{{index}}"
        bindtap="onPostTap"
      >
        <!-- Media Container -->
        <view class="media-container">
          <image 
            class="post-image"
            src="{{item.type === 'video' ? item.media[0].preview_url : item.media[0].url}}"
            lazy-load="{{true}}"
            mode="aspectFill"
          />
        </view>
        
        <!-- User Section -->
        <view class="user-section">
          <view class="user-info">
            <view class="user-row" catchtap="onUserTap" data-username="{{item.user.username}}" data-userId="{{item.user.id}}">
              <avatar avatar="{{item.user.avatar}}" name="{{item.user.username}}" size="45"></avatar>
              <text class="user-name">{{item.user.username}}</text>
            </view>
          </view>
          <view class="like-display">
            <image class="heart-icon" src="/images/icons/heart.svg" mode="aspectFit"></image>
            <text class="like-count">{{item.likes}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- Loading State -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">{{messages.loading}}</text>
    </view>
    
    <!-- Empty State -->
    <view class="empty-state" wx:if="{{!loading && posts.length === 0}}">
      <text class="empty-icon">ğŸ”</text>
      <text class="empty-title">è¿˜æ²¡æœ‰å†…å®¹</text>
      <text class="empty-desc">ç¨åå†æ¥æŸ¥çœ‹ï¼Œæˆ–è€…å°è¯•å…¶ä»–åˆ†ç±»</text>
    </view>
    
    <!-- End Message -->
    <view class="end-message" wx:if="{{!hasMore && posts.length > 0}}">
      <text class="end-text">å·²ç»åˆ°åº•äº†</text>
    </view>
  </view>

  <!-- Scroll To Top Button -->
  <view 
    wx:if="{{showScrollTop}}" 
    class="scroll-top-button" 
    bindtap="onScrollToTop"
  >
    <text class="scroll-up-icon">â¬†ï¸</text>
  </view>
  
  <!-- Tab Bar Component -->
  <douyin-tabbar current="index"></douyin-tabbar>
  
  <!-- Login Modal -->
  <login-modal wx:if="{{showLoginModal}}" bind:close="onLoginClose" bind:success="onLoginSuccess" />
  
  <!-- User ID Modal -->
  <view wx:if="{{showUserIdModal}}" class="user-id-modal-backdrop">
    <view class="user-id-modal-dialog" catchtap="">
      <view class="user-id-modal-content">
        <!-- Close button -->
        <div class="modal-close-btn" bindtap="onCloseUserIdModal">
          <image class="close-icon" src="/images/icons/X.svg" mode="aspectFit"></image>
        </div>

        <!-- Header -->
        <view class="modal-header">
          <text class="modal-title">ç”¨æˆ· ID</text>
          <text class="modal-warning">
            è¯·æ³¨æ„ï¼šæ‚¨å½“å‰çš„ ID æ˜¯ {{userInfo.username}}ã€‚
            æ‚¨åªèƒ½æ›´æ”¹ä¸€æ¬¡æ‚¨çš„ç”¨æˆ· IDï¼
          </text>
        </view>

        <!-- Form -->
        <view class="modal-form">
          <view class="form-group">
            <text class="form-label">ç”¨æˆ· ID</text>
            <input 
              class="form-input {{inputError ? 'error' : ''}}"
              type="text"
              value="{{userId}}"
              bindinput="onUserIdInput"
              placeholder="è¾“å…¥æ‚¨çš„ç”¨æˆ· ID (ä»…é™è‹±æ–‡)"
              maxlength="30"
            />
            <text wx:if="{{inputError}}" class="error-message">{{inputError}}</text>
            <text class="form-hint">åªèƒ½ä½¿ç”¨è‹±æ–‡å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿(_)ã€è¿å­—ç¬¦(-)å’Œç‚¹(.)</text>
          </view>

          <!-- Buttons -->
          <view class="modal-actions">
            <button class="modal-btn secondary" bindtap="onSkipUserIdModal">
              è·³è¿‡
            </button>
            <button class="modal-btn primary" bindtap="onSubmitUserId" disabled="{{submitLoading}}">
              <view wx:if="{{submitLoading}}" class="btn-loading">
                <view class="loading-spinner"></view>
              </view>
              <text wx:else>æäº¤</text>
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>