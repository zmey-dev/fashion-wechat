<view class="page-container">
  <!-- Page Header -->
  <view class="page-header">
    <text class="page-title">用户资料</text>
  </view>

  <!-- User Profile Container -->
  <view class="user-profile-container" wx:if="{{currentUser && !error}}">
    <!-- User Profile Information -->
    <view class="user-profile">
      <avatar class="profile-avatar" avatar="{{currentUser.avatar}}" name="{{currentUser.username}}" size="{{100}}" mode="aspectFill"></avatar>
      <text class="profile-nickname">{{currentUser.username}}</text>
      <text class="user-followers">粉丝 {{currentUser.followers}}人</text>
    </view>

    <!-- Action buttons for follow, friend, and message -->
    <view class="action-buttons">
      <!-- Follow/Unfollow Button -->
      <button 
        class="action-button {{currentUser.isFollowed ? 'bg-green-800' : 'bg-dark'}}" 
        bindtap="handleFollowToggle">
        <block wx:if="{{currentUser.isFollowed}}">
          <view class="button-content">
            <text class="icon">-</text>
            <text class="label">取消关注</text>
          </view>
        </block>
        <block wx:else>
          <view class="button-content">
            <text class="icon">✓</text>
            <text class="label">关 注</text>
          </view>
        </block>
      </button>

      <!-- Friend Button -->
      <button 
        class="action-button {{currentUser.isFriend ? (currentUser.isAllow ? 'bg-green-800' : 'bg-yellow-800') : 'bg-dark'}}" 
        bindtap="handleFriendToggle">
        <block wx:if="{{currentUser.isFriend}}">
          <view class="button-content">
            <text class="icon">-</text>
            <text class="label">取消好友</text>
          </view>
        </block>
        <block wx:else>
          <view class="button-content">
            <text class="icon">+</text>
            <text class="label">申请好友</text>
          </view>
        </block>
      </button>

      <!-- Message Button (only shown if they are friends) -->
      <button 
        class="action-button bg-dark" 
        bindtap="handleSendMessage"
        wx:if="{{currentUser.isFriend}}">
        <view class="button-content">
          <text class="icon">💬</text>
          <text class="label">留言</text>
        </view>
      </button>
    </view>

    <!-- Media grid displaying user's posts -->
    <view class="media-grid">
      <view class="media-item" wx:for="{{userMediaList}}" wx:key="id" bindtap="previewImage" data-id="{{item.id}}">
        <image wx:if="{{item.type=='image'}}" class="media-image" src="{{item.media[0].url}}" mode="aspectFill"></image>
        <image wx:else class="media-image" src="{{item.media[0].preview_url}}" mode="aspectFill"></image>
        <view class="media-info">
          <view class="media-stats">
            <text class="media-likes">♥ {{item.likes}}</text>
            <text class="media-comments">💬 {{item.comments}}</text>
          </view>
          <text class="media-description">{{item.description}}</text>
        </view>
      </view>
    </view>

    <!-- Loading indicator -->
    <view class="loading-indicator" wx:if="{{loading}}">
      <text>{{messages.loading}}</text>
    </view>
    
    <!-- No more content message -->
    <view class="no-more" wx:if="{{!hasMore && userMediaList.length > 0}}">
      <text>没有更多内容</text>
    </view>

    <!-- No posts message -->
    <view class="no-posts" wx:if="{{!loading && userMediaList.length === 0 && !error}}">
      <text>该用户还没有发布任何内容</text>
    </view>
  </view>

  <!-- Error Message -->
  <view class="error-container" wx:if="{{error}}">
    <text class="error-message">{{messages.errors.loadFailed}}</text>
    <button class="retry-button" bindtap="onPullDownRefresh">重试</button>
  </view>

  <!-- Loading Indicator for initial load -->
  <view class="loading-container" wx:if="{{loading && !currentUser}}">
    <text class="loading-text">{{messages.loading}}</text>
  </view>
</view>